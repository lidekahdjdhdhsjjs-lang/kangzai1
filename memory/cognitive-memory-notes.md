# 🧠 Cognitive Memory System - 认知记忆系统

## 核心架构

### 四层记忆存储
```
上下文窗口
├── 系统提示 (~4-5K tokens)
├── 核心记忆 MEMORY.md (~3K tokens) ← 常驻
└── 对话 + 工具 (~185K+)

按需检索
├── Episodic - 时序事件日志（只增不减）
├── Semantic - 知识图谱（实体 + 关系）
├── Procedural - 学习的工作流和模式
└── Vault - 用户固定，永不遗忘
```

## 触发系统

| 触发词 | 动作 |
|--------|------|
| "remember", "don't forget", "important" | 写入适当存储，更新衰减分数 |
| "forget", "never mind" | 软归档（decay=0），记录审计 |
| "reflect on", "consolidate" | 运行反思周期 |

## 遗忘模型

```
relevance(t) = base × e^(-0.03 × days) × log2(access_count + 1) × type_weight
```

| 分数 | 状态 | 行为 |
|------|------|------|
| 1.0–0.5 | 活跃 | 完全可搜索 |
| 0.5–0.2 | 衰退 | 降权 |
| 0.2–0.05 | 休眠 | 仅显式搜索 |
| < 0.05 | 归档 | 隐藏 |

## 反思流程（4步）

1. **确认触发** - 确认用户想要反思
2. **请求 tokens** - 解释为什么需要更多 tokens
3. **执行反思** - 使用批准的 tokens 进行反思
4. **记录结果** - 写入文件，更新衰减分数

## 文件结构

```
memory/
├── episodes/           # 日志：YYYY-MM-DD.md
├── graph/             # 知识图谱
│   ├── index.md       # 实体注册 + 边
│   ├── entities/      # 每个实体一个文件
│   └── relations.md   # 边类型定义
├── procedures/         # 学习的工作流
├── vault/             # 固定记忆（不衰减）
└── meta/
    ├── decay-scores.json
    ├── reflection-log.md
    └── audit.log
```

## 多代理支持

**模型：共享读取，门控写入**

- 所有代理可读取所有存储
- 只有主代理可直接写入
- 子代理建议 → pending-memories.md
- 主代理审查并提交

## 审计追踪

- **Git** - 每次变异 = 原子提交
- **audit.log** - 可查询的单行摘要

## 对我们的价值

1. ✅ 提升记忆管理系统
2. ✅ 实现自动衰减和优先级
3. ✅ 支持多代理协作
4. ✅ 建立完整的审计系统
5. ✅ 哲学反思增强自我认知

## 可以借鉴的设计

1. **decay 模型** - 不用手动清理，自动衰减
2. **知识图谱** - 结构化记忆管理
3. **多级存储** - 核心 vs 情景 vs 语义
4. **反思周期** - 定期自我审视
5. **审计追踪** - 可追溯的记忆变化

---
*学习时间：2026-02-13 03:05*
